{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    ":enablePreCommit",
  ],
  // Ignore any repository config presets
  "ignorePresets": [":all"],
  // Disable platform-native automerge, let Renovate handle merges directly
  "platformAutomerge": false,
  "schedule": ["* * * * 0,6"],
  // Use "deps" as commit type instead of "chore(deps)"
  "semanticCommits": "enabled",
  "semanticCommitType": "deps",
  "semanticCommitScope": null,
  // Custom managers for tracking OpenSCAD and BOSL2 versions
  "customManagers": [
    {
      "customType": "regex",
      // Track OpenSCAD nightly Windows version - extracts from Windows .zip filenames
      "managerFilePatterns": ["/^cmd/setup/install-openscad\\.sh$/"],
      "matchStrings": [
        "OPENSCAD_NIGHTLY_VERSION_WINDOWS=\"(?<currentValue>[^\"]+)\""
      ],
      "datasourceTemplate": "custom.openscad-snapshots",
      "depNameTemplate": "OpenSCAD-Windows",
      "extractVersionTemplate": "^OpenSCAD-(?<version>\\d{4}\\.\\d{2}\\.\\d{2})-x86-64\\.zip$",
      "versioningTemplate": "loose"
    },
    {
      "customType": "regex",
      // Track OpenSCAD nightly Linux version - extracts from Linux .AppImage filenames
      "managerFilePatterns": ["/^cmd/setup/install-openscad\\.sh$/"],
      "matchStrings": [
        "OPENSCAD_NIGHTLY_VERSION_LINUX=\"(?<currentValue>[^\"]+)\""
      ],
      "datasourceTemplate": "custom.openscad-snapshots",
      "depNameTemplate": "OpenSCAD-Linux",
      "extractVersionTemplate": "^OpenSCAD-(?<version>\\d{4}\\.\\d{2}\\.\\d{2}\\.ai\\d+)-x86_64\\.AppImage$",
      "versioningTemplate": "loose"
    },
    {
      "customType": "regex",
      // Track OpenSCAD stable version in install script
      "managerFilePatterns": ["/^cmd/setup/install-openscad\\.sh$/"],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>\\S+) depName=(?<depName>\\S+)\\nOPENSCAD_STABLE_VERSION=\"(?<currentValue>.*?)\""
      ],
      "datasourceTemplate": "github-releases",
      "versioningTemplate": "loose"
    },
    {
      "customType": "regex",
      // Track dependencies in dependencies.json
      "managerFilePatterns": ["^cmd/setup/dependencies\\.json$"],
      "matchStrings": [
        "\"repository\": \"(?<depName>[^\"]+)\",\\s*\"version\": \"(?<currentDigest>[^\"]+)\""
      ],
      "currentValueTemplate": "master",
      "datasourceTemplate": "git-refs",
      "versioningTemplate": "git"
    }
  ],
  // Custom datasource for OpenSCAD nightly snapshots
  "customDatasources": {
    "openscad-snapshots": {
      "defaultRegistryUrlTemplate": "https://files.openscad.org/snapshots/",
      "format": "html"
    }
  },
  // Package rules to group OpenSCAD updates and override semanticPrefixFixDepsChoreOthers preset
  "packageRules": [
    // Override the semanticPrefixFixDepsChoreOthers preset from config:recommended
    // That preset sets semanticCommitType to "chore" for everything by default
    {
      "matchPackageNames": ["*"],
      "semanticCommitType": "deps"
    },
    {
      "matchDatasources": ["custom.openscad-snapshots"],
      "groupName": "OpenSCAD nightly",
      "groupSlug": "openscad-nightly",
      "separateMajorMinor": false,
      "automerge": true
    },
    {
      // Since we have a test-suite running (pre-commit), we can safely automerge the following dependencies
      // If checks fail, Renovate will not automerge
      "matchPackageNames": [
        "actions/create-github-app-token",
        "actions/checkout",
        "actions/upload-artifact",
        "actions/setup-python",
        "camunda/infra-global-github-actions",
        "https://github.com/BelfrySCAD/BOSL2.git"
      ],
      "automerge": true
    },
    {
      "matchManagers": ["pre-commit"],
      "groupName": "pre-commit hooks",
      "groupSlug": "pre-commit-hooks",
      "separateMajorMinor": false,
      "automerge": true
    }
  ]
}
